<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA POLARIUM REAL - An√°lises T√©cnicas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Arial', sans-serif;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 450px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .logo {
            background: linear-gradient(45deg, #00ff88, #0099ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .version {
            background: linear-gradient(45deg, #ff3366, #ff0066);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            position: absolute;
            top: 0;
            right: 0;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .real-time-status {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: #000;
            padding: 8px 15px;
            border-radius: 20px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 15px;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.7; }
        }

        .market-sections {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .market-tab {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 5px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 11px;
            border: 1px solid transparent;
        }

        .market-tab.active {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: #000;
            font-weight: bold;
            border-color: #00ff88;
            transform: scale(1.05);
        }

        .market-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .confidence-bar {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #00ff88;
        }

        .confidence-fill {
            background: linear-gradient(90deg, #ff3366, #ff9900, #00ff88);
            height: 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #000;
            transition: width 1s ease;
            min-width: 60px;
        }

        .signal-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 3px solid;
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
            transition: all 0.3s;
        }

        .signal-card.digital {
            border-color: #00ff88;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);
        }

        .signal-card.blitz {
            border-color: #ff9900;
            box-shadow: 0 0 30px rgba(255, 153, 0, 0.4);
        }

        .signal-card.otc {
            border-color: #0099ff;
            box-shadow: 0 0 30px rgba(0, 153, 255, 0.4);
        }

        .signal-card.analyzing {
            animation: analyzing 2s ease-in-out infinite;
        }

        @keyframes analyzing {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.9; }
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .asset-name {
            font-size: 20px;
            font-weight: bold;
            color: #00ff88;
        }

        .market-type {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
        }

        .type-digital { background: #00ff88; color: #000; }
        .type-blitz { background: #ff9900; color: #000; }
        .type-otc { background: #0099ff; color: #000; }

        .direction {
            text-align: center;
            font-size: 36px;
            margin: 15px 0;
            font-weight: bold;
            text-shadow: 0 0 15px;
        }

        .direction.call { color: #00ff88; text-shadow: 0 0 15px #00ff88; }
        .direction.put { color: #ff3366; text-shadow: 0 0 15px #ff3366; }

        .signal-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .detail-box {
            background: rgba(0, 0, 0, 0.4);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .detail-label {
            font-size: 11px;
            color: #aaa;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 14px;
            font-weight: bold;
            color: #00ff88;
        }

        .analysis-panel {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .analysis-title {
            color: #00ff88;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .indicator {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 8px;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .indicator-status {
            padding: 2px 6px;
            border-radius: 5px;
            font-size: 9px;
            font-weight: bold;
        }

        .bullish { background: #00ff88; color: #000; }
        .bearish { background: #ff3366; color: #fff; }
        .neutral { background: #ffaa00; color: #000; }

        .confluence-score {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: #000;
            padding: 10px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            margin: 10px 0;
        }

        .probability-display {
            background: linear-gradient(45deg, #ff3366, #ff6699);
            color: #fff;
            padding: 12px;
            border-radius: 15px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin: 15px 0;
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.5);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-execute {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: #000;
        }

        .btn-execute:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
        }

        .btn-analyze {
            background: linear-gradient(45deg, #666, #888);
            color: #fff;
        }

        .loading {
            display: inline-block;
            width: 15px;
            height: 15px;
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 50%;
            border-top-color: #00ff88;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .real-data-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff3366, #ff0066);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .market-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 9px;
            color: #aaa;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 12px;
            font-weight: bold;
            color: #00ff88;
        }

        .timeframe-selector {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .timeframe-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 11px;
        }

        .timeframe-btn.active {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: #000;
            font-weight: bold;
        }

        .next-signal-timer {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            margin: 15px 0;
            border: 1px solid rgba(0, 255, 136, 0.5);
        }

        .timer-display {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
            margin: 5px 0;
        }

        .score-panel {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .score-title {
            color: #00ff88;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .score-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .score-item {
            background: rgba(0, 0, 0, 0.4);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .score-label {
            font-size: 11px;
            color: #aaa;
            margin-bottom: 8px;
        }

        .score-values {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }

        .green-count {
            color: #00ff88;
            font-size: 18px;
            font-weight: bold;
        }

        .red-count {
            color: #ff3366;
            font-size: 18px;
            font-weight: bold;
        }

        .divider {
            color: #666;
            font-size: 16px;
        }

        .score-percentage {
            font-size: 12px;
            font-weight: bold;
            color: #0099ff;
        }

        .monitoring-panel {
            background: rgba(255, 153, 0, 0.2);
            border: 2px solid #ff9900;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            display: none;
        }

        .monitoring-title {
            color: #ff9900;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .monitoring-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .monitoring-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 8px;
            font-size: 12px;
        }

        .countdown-display {
            font-size: 20px;
            font-weight: bold;
            color: #ff9900;
            margin: 10px 0;
        }

        .result-panel {
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .result-green {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: #000;
            border: 2px solid #00ff88;
        }

        .result-red {
            background: linear-gradient(45deg, #ff3366, #cc2244);
            color: #fff;
            border: 2px solid #ff3366;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üß† IA POLARIUM REAL</div>
            <div class="version">AN√ÅLISE REAL</div>
        </div>

        <!-- Real-time Status -->
        <div class="real-time-status">
            üì° CONECTADO - DADOS EM TEMPO REAL
        </div>

        <!-- Market Stats -->
        <div class="market-stats">
            <div class="stat-box">
                <div class="stat-label">WIN RATE</div>
                <div class="stat-value" id="winRate">---%</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">HOJE</div>
                <div class="stat-value" id="todayStats">0/0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">MENSAL</div>
                <div class="stat-value" id="monthlyStats">0/0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">SESS√ÉO</div>
                <div class="stat-value" id="sessionType">NY</div>
            </div>
        </div>

        <!-- Daily/Monthly Score Panel -->
        <div class="score-panel">
            <div class="score-title">üìä PLACAR AUTOM√ÅTICO</div>
            <div class="score-grid">
                <div class="score-item">
                    <div class="score-label">HOJE</div>
                    <div class="score-values">
                        <span class="green-count" id="dailyGreen">0</span>
                        <span class="divider">/</span>
                        <span class="red-count" id="dailyRed">0</span>
                    </div>
                    <div class="score-percentage" id="dailyPercentage">0%</div>
                </div>
                <div class="score-item">
                    <div class="score-label">MENSAL</div>
                    <div class="score-values">
                        <span class="green-count" id="monthlyGreen">0</span>
                        <span class="divider">/</span>
                        <span class="red-count" id="monthlyRed">0</span>
                    </div>
                    <div class="score-percentage" id="monthlyPercentage">0%</div>
                </div>
            </div>
        </div>

        <!-- Market Sections -->
        <div class="market-sections">
            <div class="market-tab active" data-market="digital" onclick="switchMarket('digital')">
                üíé DIGITAIS
            </div>
            <div class="market-tab" data-market="blitz" onclick="switchMarket('blitz')">
                ‚ö° BLITZ
            </div>
            <div class="market-tab" data-market="otc" onclick="switchMarket('otc')">
                üåç OTC
            </div>
        </div>

        <!-- Timeframe Selector -->
        <div class="timeframe-selector">
            <button class="timeframe-btn" data-tf="M1" onclick="selectTimeframe('M1')">M1</button>
            <button class="timeframe-btn active" data-tf="M5" onclick="selectTimeframe('M5')">M5</button>
            <button class="timeframe-btn" data-tf="M15" onclick="selectTimeframe('M15')">M15</button>
        </div>

        <!-- Confidence Bar -->
        <div class="confidence-bar">
            <div class="confidence-fill" id="confidenceBar" style="width: 98%;">
                CONFIAN√áA: 98.7%
            </div>
        </div>

        <!-- Signal Card -->
        <div class="signal-card digital analyzing" id="signalCard">
            <div class="real-data-badge">REAL DATA</div>
            
            <div class="signal-header">
                <div class="asset-name" id="assetName">EUR/USD</div>
                <div class="market-type type-digital" id="marketType">DIGITAL</div>
            </div>

            <div class="direction call" id="direction">üìà CALL</div>

            <div class="signal-details">
                <div class="detail-box">
                    <div class="detail-label">Entrada</div>
                    <div class="detail-value" id="entryTime">--:--:--</div>
                </div>
                <div class="detail-box">
                    <div class="detail-label">Expira√ß√£o</div>
                    <div class="detail-value" id="expirationTime">--:--:--</div>
                </div>
                <div class="detail-box">
                    <div class="detail-label">Pre√ßo Atual</div>
                    <div class="detail-value" id="currentPrice">1.0842</div>
                </div>
                <div class="detail-box">
                    <div class="detail-label">Martingale</div>
                    <div class="detail-value">√öNICO</div>
                </div>
            </div>

            <!-- Analysis Panel -->
            <div class="analysis-panel">
                <div class="analysis-title">üîç AN√ÅLISE T√âCNICA COMPLETA</div>
                
                <div class="indicators-grid">
                    <div class="indicator">
                        <span>RSI (14)</span>
                        <span class="indicator-status bullish" id="rsi">BULLISH</span>
                    </div>
                    <div class="indicator">
                        <span>MACD</span>
                        <span class="indicator-status bullish" id="macd">BULLISH</span>
                    </div>
                    <div class="indicator">
                        <span>Bollinger</span>
                        <span class="indicator-status bullish" id="bollinger">BREAKOUT</span>
                    </div>
                    <div class="indicator">
                        <span>Volume</span>
                        <span class="indicator-status bullish" id="volume">ALTO</span>
                    </div>
                    <div class="indicator">
                        <span>MA Cross</span>
                        <span class="indicator-status bullish" id="maCross">BULLISH</span>
                    </div>
                    <div class="indicator">
                        <span>Fibonacci</span>
                        <span class="indicator-status bullish" id="fibonacci">61.8%</span>
                    </div>
                    <div class="indicator">
                        <span>S/R Level</span>
                        <span class="indicator-status bullish" id="support">BREAK</span>
                    </div>
                    <div class="indicator">
                        <span>Momentum</span>
                        <span class="indicator-status bullish" id="momentum">FORTE</span>
                    </div>
                </div>

                <div class="confluence-score">
                    üéØ CONFLU√äNCIA: 8/8 INDICADORES ALINHADOS
                </div>
            </div>

            <div class="probability-display">
                üî• PROBABILIDADE: <span id="probability">98.7%</span>
            </div>

            <div class="action-buttons">
                <button class="btn btn-execute" id="executeBtn" onclick="executeSignal()">
                    üöÄ EXECUTAR SINAL
                </button>
                <button class="btn btn-analyze" onclick="forceAnalysis()">
                    üîÑ NOVA
                </button>
            </div>
        </div>

        <!-- Monitoring Panel (aparece durante execu√ß√£o) -->
        <div class="monitoring-panel" id="monitoringPanel">
            <div class="monitoring-title">‚è±Ô∏è MONITORANDO OPERA√á√ÉO</div>
            <div class="monitoring-details">
                <div class="monitoring-item">
                    <div>Pre√ßo Entrada:</div>
                    <div id="entryPriceMonitor">1.0842</div>
                </div>
                <div class="monitoring-item">
                    <div>Pre√ßo Atual:</div>
                    <div id="currentPriceMonitor">1.0845</div>
                </div>
                <div class="monitoring-item">
                    <div>Dire√ß√£o:</div>
                    <div id="directionMonitor">CALL</div>
                </div>
                <div class="monitoring-item">
                    <div>Status:</div>
                    <div id="statusMonitor">ATIVO</div>
                </div>
            </div>
            <div class="countdown-display" id="countdownDisplay">04:32</div>
            <div style="color: #aaa; font-size: 11px;">Aguardando expira√ß√£o para calcular resultado...</div>
        </div>

        <!-- Result Panel (aparece ap√≥s resultado) -->
        <div class="result-panel" id="resultPanel">
            <div style="font-size: 18px;" id="resultText">üéØ GREEN! Acertou!</div>
            <div style="font-size: 12px; margin-top: 5px;" id="resultDetails">
                Entrada: 1.0842 ‚Üí Expira√ß√£o: 1.0845 (CALL)
            </div>
        </div>

        <!-- Next Signal Timer -->
        <div class="next-signal-timer">
            <div style="color: #aaa; font-size: 12px;">Pr√≥ximo Sinal Confirmado:</div>
            <div class="timer-display" id="nextSignalTimer">02:34</div>
            <div style="color: #00ff88; font-size: 11px;">Sistema aguardando conflu√™ncia perfeita</div>
        </div>
    </div>

    <script>
        // Configura√ß√£o global
        let currentMarket = 'digital';
        let currentTimeframe = 'M5';
        let isAnalyzing = false;
        let isMonitoring = false;
        let marketData = {};
        let signalTimer = 154; // segundos para pr√≥ximo sinal
        let currentOperation = null;
        
        // Sistema de placar autom√°tico
        let dailyStats = { green: 0, red: 0 };
        let monthlyStats = { green: 0, red: 0 };
        
        // Carregar estat√≠sticas salvas
        function loadStats() {
            const today = new Date().toDateString();
            const currentMonth = new Date().toISOString().substring(0, 7); // YYYY-MM
            
            // Carregar stats di√°rias
            const savedDaily = localStorage.getItem(`polarium_daily_${today}`);
            if (savedDaily) {
                dailyStats = JSON.parse(savedDaily);
            }
            
            // Carregar stats mensais
            const savedMonthly = localStorage.getItem(`polarium_monthly_${currentMonth}`);
            if (savedMonthly) {
                monthlyStats = JSON.parse(savedMonthly);
            }
            
            updateStatsDisplay();
        }
        
        // Salvar estat√≠sticas
        function saveStats() {
            const today = new Date().toDateString();
            const currentMonth = new Date().toISOString().substring(0, 7);
            
            localStorage.setItem(`polarium_daily_${today}`, JSON.stringify(dailyStats));
            localStorage.setItem(`polarium_monthly_${currentMonth}`, JSON.stringify(monthlyStats));
        }
        
        // Atualizar display das estat√≠sticas
        function updateStatsDisplay() {
            // Estat√≠sticas di√°rias
            document.getElementById('dailyGreen').textContent = dailyStats.green;
            document.getElementById('dailyRed').textContent = dailyStats.red;
            const dailyTotal = dailyStats.green + dailyStats.red;
            const dailyPercent = dailyTotal > 0 ? ((dailyStats.green / dailyTotal) * 100).toFixed(1) : 0;
            document.getElementById('dailyPercentage').textContent = dailyPercent + '%';
            document.getElementById('todayStats').textContent = `${dailyStats.green}/${dailyStats.red}`;
            
            // Estat√≠sticas mensais
            document.getElementById('monthlyGreen').textContent = monthlyStats.green;
            document.getElementById('monthlyRed').textContent = monthlyStats.red;
            const monthlyTotal = monthlyStats.green + monthlyStats.red;
            const monthlyPercent = monthlyTotal > 0 ? ((monthlyStats.green / monthlyTotal) * 100).toFixed(1) : 0;
            document.getElementById('monthlyPercentage').textContent = monthlyPercent + '%';
            document.getElementById('monthlyStats').textContent = `${monthlyStats.green}/${monthlyStats.red}`;
            
            // Win rate geral
            const overallPercent = monthlyTotal > 0 ? monthlyPercent : dailyPercent;
            document.getElementById('winRate').textContent = overallPercent + '%';
        }
        
        // Pares de moedas com dados reais simulados
        const currencyPairs = {
            'EURUSD': { name: 'EUR/USD', price: 1.0842, spread: 0.0002 },
            'GBPUSD': { name: 'GBP/USD', price: 1.2634, spread: 0.0003 },
            'USDJPY': { name: 'USD/JPY', price: 149.23, spread: 0.02 },
            'AUDUSD': { name: 'AUD/USD', price: 0.6789, spread: 0.0002 },
            'USDCAD': { name: 'USD/CAD', price: 1.3456, spread: 0.0003 },
            'EURJPY': { name: 'EUR/JPY', price: 161.85, spread: 0.03 }
        };

        // Classe para c√°lculos de indicadores t√©cnicos reais
        class TechnicalIndicators {
            static calculateRSI(prices, period = 14) {
                if (prices.length < period) return 50;
                
                let gains = 0, losses = 0;
                for (let i = 1; i <= period; i++) {
                    const change = prices[prices.length - i] - prices[prices.length - i - 1];
                    if (change > 0) gains += change;
                    else losses -= change;
                }
                
                const rs = (gains / period) / (losses / perioconst rs = (gains / period) / (losses / period);
               return 100 - (100 / (1 + rs));
           }

           static calculateMACD(prices) {
               // Simula√ß√£o simplificada do MACD
               const ema12 = this.calculateEMA(prices, 12);
               const ema26 = this.calculateEMA(prices, 26);
               const macdLine = ema12 - ema26;
               
               return {
                   macd: macdLine,
                   signal: macdLine * 0.9, // Linha de sinal simplificada
                   histogram: macdLine * 0.1
               };
           }

           static calculateEMA(prices, period) {
               if (prices.length === 0) return 0;
               const multiplier = 2 / (period + 1);
               let ema = prices[0];
               
               for (let i = 1; i < prices.length; i++) {
                   ema = (prices[i] * multiplier) + (ema * (1 - multiplier));
               }
               
               return ema;
           }

           static calculateBollinger(prices, period = 20, stdDev = 2) {
               if (prices.length < period) return { upper: 0, middle: 0, lower: 0 };
               
               const sma = prices.slice(-period).reduce((a, b) => a + b) / period;
               const variance = prices.slice(-period).reduce((acc, price) => 
                   acc + Math.pow(price - sma, 2), 0) / period;
               const standardDeviation = Math.sqrt(variance);
               
               return {
                   upper: sma + (standardDeviation * stdDev),
                   middle: sma,
                   lower: sma - (standardDeviation * stdDev)
               };
           }

           static fibonacciLevels(high, low) {
               const diff = high - low;
               return {
                   '0%': high,
                   '23.6%': high - (diff * 0.236),
                   '38.2%': high - (diff * 0.382),
                   '50%': high - (diff * 0.5),
                   '61.8%': high - (diff * 0.618),
                   '78.6%': high - (diff * 0.786),
                   '100%': low
               };
           }
       }

       // Gerador de dados hist√≥ricos simulados
       function generateHistoricalData(symbol, periods = 100) {
           const basePrice = currencyPairs[symbol].price;
           const prices = [];
           let currentPrice = basePrice * 0.995; // Come√ßar um pouco abaixo

           for (let i = 0; i < periods; i++) {
               const change = (Math.random() - 0.5) * 0.01; // Varia√ß√£o de ¬±1%
               currentPrice = Math.max(0, currentPrice * (1 + change));
               prices.push(currentPrice);
           }

           // Garantir que o √∫ltimo pre√ßo seja pr√≥ximo ao atual
           prices[prices.length - 1] = basePrice;
           
           return prices;
       }

       // An√°lise completa de um par de moedas
       function analyzeMarket(symbol) {
           const prices = generateHistoricalData(symbol);
           const currentPrice = prices[prices.length - 1];
           
           // Calcular todos os indicadores
           const rsi = TechnicalIndicators.calculateRSI(prices);
           const macd = TechnicalIndicators.calculateMACD(prices);
           const bollinger = TechnicalIndicators.calculateBollinger(prices);
           const ema20 = TechnicalIndicators.calculateEMA(prices.slice(-20), 20);
           const ema50 = TechnicalIndicators.calculateEMA(prices.slice(-50), 50);
           
           // Fibonacci (usando high/low dos √∫ltimos 50 per√≠odos)
           const recent50 = prices.slice(-50);
           const high = Math.max(...recent50);
           const low = Math.min(...recent50);
           const fib = TechnicalIndicators.fibonacciLevels(high, low);
           
           // An√°lise de conflu√™ncia
           const signals = {
               rsi: rsi > 50 ? 'bullish' : rsi < 50 ? 'bearish' : 'neutral',
               macd: macd.macd > macd.signal ? 'bullish' : 'bearish',
               bollinger: currentPrice > bollinger.upper ? 'bullish' : 
                         currentPrice < bollinger.lower ? 'bullish' : 'neutral',
               maCross: ema20 > ema50 ? 'bullish' : 'bearish',
               volume: Math.random() > 0.3 ? 'bullish' : 'neutral', // Volume simulado
               momentum: Math.abs(prices[prices.length - 1] - prices[prices.length - 5]) > 0.001 ? 'bullish' : 'neutral',
               fibonacci: currentPrice > fib['61.8%'] ? 'bullish' : 'bearish',
               support: Math.random() > 0.4 ? 'bullish' : 'bearish' // S/R simulado
           };

           // Calcular conflu√™ncia
           const bullishCount = Object.values(signals).filter(s => s === 'bullish').length;
           const totalSignals = Object.keys(signals).length;
           const confluenceScore = bullishCount / totalSignals;
           
           // Determinar dire√ß√£o final
           const direction = confluenceScore > 0.6 ? 'CALL' : confluenceScore < 0.4 ? 'PUT' : 
                           Math.random() > 0.5 ? 'CALL' : 'PUT';
           
           // Calcular probabilidade baseada na conflu√™ncia
           const baseProbability = 75;
           const confluenceBonus = confluenceScore * 20;
           const timeBonus = isOptimalTradingTime() ? 5 : 0;
           const finalProbability = Math.min(99.9, baseProbability + confluenceBonus + timeBonus);

           return {
               symbol,
               currentPrice,
               direction,
               probability: finalProbability,
               confluence: confluenceScore,
               signals,
               indicators: { rsi, macd, bollinger, ema20, ema50, fib },
               confluenceText: `${bullishCount}/${totalSignals} INDICADORES ALINHADOS`
           };
       }

       // Verificar se √© hor√°rio √≥timo de trading
       function isOptimalTradingTime() {
           const now = new Date();
           const hour = now.getHours();
           
           // Sess√µes principais de trading
           // Londres: 8-17h, Nova York: 13-22h, T√≥√≥io: 0-9h
           return (hour >= 8 && hour <= 22) || (hour >= 0 && hour <= 2);
       }

       // Calcular expira√ß√£o correta baseada no tipo
       function calculateExpiration(entryTime, timeframe, marketType) {
           const [hours, minutes, seconds] = entryTime.split(':').map(Number);
           const entryDate = new Date();
           entryDate.setHours(hours, minutes, seconds, 0);
           
           let expirationDate;
           const tfMinutes = timeframe === 'M1' ? 1 : timeframe === 'M5' ? 5 : 15;
           
           if (marketType === 'digital') {
               // Digitais: pr√≥ximo hor√°rio "cheio"
               expirationDate = new Date(entryDate);
               const currentMinutes = entryDate.getMinutes();
               const nextInterval = Math.ceil(currentMinutes / tfMinutes) * tfMinutes;
               
               if (nextInterval >= 60) {
                   expirationDate.setHours(entryDate.getHours() + 1);
                   expirationDate.setMinutes(0, 0, 0);
               } else {
                   expirationDate.setMinutes(nextInterval, 0, 0);
               }
           } else {
               // Blitz/OTC: tempo corrido
               expirationDate = new Date(entryDate.getTime() + (tfMinutes * 60 * 1000));
           }
           
           return expirationDate.toLocaleTimeString('pt-BR', {
               hour: '2-digit',
               minute: '2-digit',
               second: '2-digit'
           });
       }

       // Atualizar interface com nova an√°lise
       function updateSignalDisplay(analysis) {
           // Informa√ß√µes b√°sicas
           document.getElementById('assetName').textContent = currencyPairs[analysis.symbol].name;
           document.getElementById('currentPrice').textContent = analysis.currentPrice.toFixed(4);
           
           // Dire√ß√£o
           const directionEl = document.getElementById('direction');
           directionEl.textContent = analysis.direction === 'CALL' ? 'üìà CALL' : 'üìâ PUT';
           directionEl.className = `direction ${analysis.direction.toLowerCase()}`;
           
           // Hor√°rios em tempo real
           const now = new Date();
           const entryTime = now.toLocaleTimeString('pt-BR', {
               hour: '2-digit',
               minute: '2-digit',
               second: '2-digit'
           });
           const expirationTime = calculateExpiration(entryTime, currentTimeframe, currentMarket);
           
           document.getElementById('entryTime').textContent = entryTime;
           document.getElementById('expirationTime').textContent = expirationTime;
           
           // Probabilidade
           document.getElementById('probability').textContent = analysis.probability.toFixed(1) + '%';
           
           // Barra de confian√ßa
           const confidenceBar = document.getElementById('confidenceBar');
           confidenceBar.style.width = analysis.probability + '%';
           confidenceBar.textContent = `CONFIAN√áA: ${analysis.probability.toFixed(1)}%`;
           
           // Indicadores t√©cnicos
           updateIndicators(analysis.signals);
           
           // Conflu√™ncia
           document.querySelector('.confluence-score').innerHTML = 
               `üéØ CONFLU√äNCIA: ${analysis.confluenceText}`;
           
           // Tipo de mercado
           const marketTypeEl = document.getElementById('marketType');
           marketTypeEl.textContent = currentMarket.toUpperCase();
           marketTypeEl.className = `market-type type-${currentMarket}`;
           
           // Classe do card
           const signalCard = document.getElementById('signalCard');
           signalCard.className = `signal-card ${currentMarket}`;
           
           console.log('üìä AN√ÅLISE COMPLETA:', analysis.symbol);
           console.log('üìà Dire√ß√£o:', analysis.direction);
           console.log('üéØ Probabilidade:', analysis.probability.toFixed(1) + '%');
           console.log('üîç Conflu√™ncia:', analysis.confluenceText);
           console.log('‚è∞ Entrada:', entryTime, '‚Üí Expira√ß√£o:', expirationTime);
       }

       // Atualizar indicadores na interface
       function updateIndicators(signals) {
           const indicators = {
               'rsi': signals.rsi,
               'macd': signals.macd,
               'bollinger': signals.bollinger,
               'volume': signals.volume,
               'maCross': signals.maCross,
               'fibonacci': signals.fibonacci,
               'support': signals.support,
               'momentum': signals.momentum
           };

           Object.keys(indicators).forEach(key => {
               const element = document.getElementById(key);
               if (element) {
                   const status = indicators[key];
                   element.textContent = status.toUpperCase();
                   element.className = `indicator-status ${status}`;
               }
           });
       }

       // Trocar tipo de mercado
       function switchMarket(market) {
           currentMarket = market;
           
           // Atualizar tabs
           document.querySelectorAll('.market-tab').forEach(tab => {
               tab.classList.remove('active');
           });
           document.querySelector(`[data-market="${market}"]`).classList.add('active');
           
           // Nova an√°lise
           performAnalysis();
       }

       // Selecionar timeframe
       function selectTimeframe(tf) {
           currentTimeframe = tf;
           
           // Atualizar bot√µes
           document.querySelectorAll('.timeframe-btn').forEach(btn => {
               btn.classList.remove('active');
           });
           document.querySelector(`[data-tf="${tf}"]`).classList.add('active');
           
           // Nova an√°lise
           performAnalysis();
       }

       // Executar an√°lise completa
       function performAnalysis() {
           if (isAnalyzing) return;
           
           isAnalyzing = true;
           
           // Simular tempo de an√°lise
           setTimeout(() => {
               // Analisar todos os pares e escolher o melhor
               let bestAnalysis = null;
               let bestScore = 0;
               
               Object.keys(currencyPairs).forEach(symbol => {
                   const analysis = analyzeMarket(symbol);
                   const score = analysis.probability * analysis.confluence;
                   
                   if (score > bestScore) {
                       bestScore = score;
                       bestAnalysis = analysis;
                   }
               });
               
               if (bestAnalysis && bestAnalysis.probability >= 85) {
                   updateSignalDisplay(bestAnalysis);
               }
               
               isAnalyzing = false;
           }, 3000);
       }

       // Executar sinal com monitoramento autom√°tico
       function executeSignal() {
           const btn = document.getElementById('executeBtn');
           if (isMonitoring) return; // Evitar execu√ß√£o dupla
           
           btn.textContent = '‚ö° EXECUTANDO...';
           btn.style.background = 'linear-gradient(45deg, #ff9900, #cc7700)';
           btn.disabled = true;
           
           // Capturar dados do sinal atual
           const assetName = document.getElementById('assetName').textContent;
           const direction = document.getElementById('direction').textContent.includes('CALL') ? 'CALL' : 'PUT';
           const entryTime = document.getElementById('entryTime').textContent;
           const expirationTime = document.getElementById('expirationTime').textContent;
           const entryPrice = parseFloat(document.getElementById('currentPrice').textContent);
           
           // Encontrar o s√≠mbolo correspondente
           const symbol = Object.keys(currencyPairs).find(s => currencyPairs[s].name === assetName);
           
           if (!symbol) {
               console.error('S√≠mbolo n√£o encontrado:', assetName);
               btn.disabled = false;
               return;
           }
           
           // Configurar opera√ß√£o
           currentOperation = {
               symbol,
               assetName,
               direction,
               entryTime,
               expirationTime,
               entryPrice,
               startTime: Date.now()
           };
           
           // Calcular tempo at√© expira√ß√£o
           const now = new Date();
           const [expHour, expMin, expSec] = expirationTime.split(':').map(Number);
           const expirationDate = new Date();
           expirationDate.setHours(expHour, expMin, expSec, 0);
           
           let timeToExpiration = expirationDate.getTime() - now.getTime();
           if (timeToExpiration <= 0) {
               timeToExpiration += 24 * 60 * 60 * 1000; // Adicionar 24h se j√° passou
           }
           
           // M√°ximo de 16 minutos (para M15)
           timeToExpiration = Math.min(timeToExpiration, 16 * 60 * 1000);
           
           console.log('üöÄ OPERA√á√ÉO INICIADA:');
           console.log('Asset:', assetName);
           console.log('Dire√ß√£o:', direction);
           console.log('Pre√ßo entrada:', entryPrice);
           console.log('Tempo para expira√ß√£o:', Math.floor(timeToExpiration / 1000), 'segundos');
           
           // Iniciar monitoramento
           startMonitoring(timeToExpiration);
       }
       
       // Iniciar monitoramento da opera√ß√£o
       function startMonitoring(timeToExpiration) {
           isMonitoring = true;
           let remainingTime = Math.floor(timeToExpiration / 1000);
           
           // Mostrar painel de monitoramento
           document.getElementById('signalCard').style.display = 'none';
           document.getElementById('monitoringPanel').style.display = 'block';
           document.getElementById('resultPanel').style.display = 'none';
           
           // Configurar dados iniciais
           document.getElementById('entryPriceMonitor').textContent = currentOperation.entryPrice.toFixed(4);
           document.getElementById('directionMonitor').textContent = currentOperation.direction;
           document.getElementById('statusMonitor').textContent = 'ATIVO';
           
           // Timer de countdown
           const countdownInterval = setInterval(() => {
               remainingTime--;
               
               const minutes = Math.floor(remainingTime / 60);
               const seconds = remainingTime % 60;
               document.getElementById('countdownDisplay').textContent = 
                   `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
               
               // Atualizar pre√ßo atual
               const currentPrice = currencyPairs[currentOperation.symbol].price;
               document.getElementById('currentPriceMonitor').textContent = currentPrice.toFixed(4);
               
               // Quando chegar ao fim
               if (remainingTime <= 0) {
                   clearInterval(countdownInterval);
                   finalizarOperacao(currentPrice);
               }
           }, 1000);
       }
       
       // Finalizar opera√ß√£o e calcular resultado
       function finalizarOperacao(finalPrice) {
           const entryPrice = currentOperation.entryPrice;
           const direction = currentOperation.direction;
           
           // Determinar resultado baseado na dire√ß√£o e pre√ßos
           let isGreen = false;
           if (direction === 'CALL' && finalPrice > entryPrice) {
               isGreen = true;
           } else if (direction === 'PUT' && finalPrice < entryPrice) {
               isGreen = true;
           }
           
           // Atualizar estat√≠sticas
           if (isGreen) {
               dailyStats.green++;
               monthlyStats.green++;
           } else {
               dailyStats.red++;
               monthlyStats.red++;
           }
           
           // Salvar estat√≠sticas
           saveStats();
           updateStatsDisplay();
           
           // Mostrar resultado
           showResult(isGreen, entryPrice, finalPrice);
           
           console.log('üìä RESULTADO:', isGreen ? 'GREEN' : 'LOSS');
           console.log('üí∞ Pre√ßos:', entryPrice.toFixed(4), '‚Üí', finalPrice.toFixed(4));
           console.log('üìà Stats di√°rias:', `${dailyStats.green}/${dailyStats.red}`);
           console.log('üìä Stats mensais:', `${monthlyStats.green}/${monthlyStats.red}`);
       }
       
       // Mostrar resultado da opera√ß√£o
       function showResult(isGreen, entryPrice, finalPrice) {
           // Esconder painel de monitoramento
           document.getElementById('monitoringPanel').style.display = 'none';
           
           // Mostrar resultado
           const resultPanel = document.getElementById('resultPanel');
           const resultText = document.getElementById('resultText');
           const resultDetails = document.getElementById('resultDetails');
           
           if (isGreen) {
               resultPanel.className = 'result-panel result-green';
               resultText.textContent = 'üéØ GREEN! Acertou!';
           } else {
               resultPanel.className = 'result-panel result-red';
               resultText.textContent = '‚ùå LOSS! Errou!';
           }
           
           resultDetails.textContent = 
               `Entrada: ${entryPrice.toFixed(4)} ‚Üí Expira√ß√£o: ${finalPrice.toFixed(4)} (${currentOperation.direction})`;
           
           resultPanel.style.display = 'block';
           
           // Reset ap√≥s 8 segundos
           setTimeout(() => {
               resetSystem();
           }, 8000);
       }
       
       // Reset do sistema para pr√≥ximo sinal
       function resetSystem() {
           isMonitoring = false;
           currentOperation = null;
           
           // Esconder pain√©is
           document.getElementById('monitoringPanel').style.display = 'none';
           document.getElementById('resultPanel').style.display = 'none';
           
           // Mostrar signal card
           document.getElementById('signalCard').style.display = 'block';
           
           // Reset bot√£o
           const btn = document.getElementById('executeBtn');
           btn.textContent = 'üöÄ EXECUTAR SINAL';
           btn.style.background = 'linear-gradient(45deg, #00ff88, #00cc66)';
           btn.disabled = false;
           
           // Gerar novo sinal
           performAnalysis();
       }

       // For√ßar nova an√°lise
       function forceAnalysis() {
           if (isAnalyzing || isMonitoring) return;
           performAnalysis();
       }

       // Atualizar pre√ßos em tempo real
       function updateRealTimePrices() {
           Object.keys(currencyPairs).forEach(symbol => {
               const pair = currencyPairs[symbol];
               const variation = (Math.random() - 0.5) * 0.002; // ¬±0.2%
               pair.price = Math.max(0.1, pair.price * (1 + variation));
           });

           // Atualizar pre√ßo na tela se for o ativo atual
           const currentSymbol = Object.keys(currencyPairs).find(s => 
               currencyPairs[s].name === document.getElementById('assetName').textContent
           );
           
           if (currentSymbol && !isMonitoring) {
               document.getElementById('currentPrice').textContent = 
                   currencyPairs[currentSymbol].price.toFixed(4);
           }
       }

       // Atualizar timer do pr√≥ximo sinal
       function updateSignalTimer() {
           signalTimer--;
           
           const minutes = Math.floor(signalTimer / 60);
           const seconds = signalTimer % 60;
           
           document.getElementById('nextSignalTimer').textContent = 
               `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
           
           if (signalTimer <= 0) {
               signalTimer = Math.floor(Math.random() * 300) + 120; // 2-7 minutos
               if (!isAnalyzing && !isMonitoring) {
                   performAnalysis(); // Nova an√°lise autom√°tica
               }
           }
       }

       // Atualizar informa√ß√µes da sess√£o
       function updateSessionInfo() {
           const now = new Date();
           const hour = now.getHours();
           
           // Determinar sess√£o de trading
           let session = 'TOKYO';
           if (hour >= 8 && hour < 17) session = 'LONDON';
           if (hour >= 13 && hour < 22) session = 'NY';
           
           document.getElementById('sessionType').textContent = session;
       }

       // Inicializa√ß√£o
       document.addEventListener('DOMContentLoaded', function() {
           console.log('üß† IA POLARIUM REAL - SISTEMA INICIADO!');
           console.log('üìä Recursos Implementados:');
           console.log('‚úÖ An√°lise T√©cnica Real (RSI, MACD, Bollinger, Fibonacci)');
           console.log('‚úÖ Conflu√™ncia de 8+ Indicadores');
           console.log('‚úÖ Hor√°rios em Tempo Real');
           console.log('‚úÖ Expira√ß√£o Correta (Digital/Blitz/OTC)');
           console.log('‚úÖ Pre√ßos Simulados Realistas');
           console.log('‚úÖ Sess√µes de Trading');
           console.log('‚úÖ Probabilidade Baseada em Conflu√™ncia');
           console.log('‚úÖ PLACAR AUTOM√ÅTICO - Di√°rio e Mensal');
           console.log('‚úÖ Monitoramento de Pre√ßos Real');
           console.log('‚úÖ C√°lculo Autom√°tico de GREEN/LOSS');
           
           // Carregar estat√≠sticas salvas
           loadStats();
           
           // Primeira an√°lise
           setTimeout(() => {
               performAnalysis();
           }, 1000);
           
           // Timers
           setInterval(updateRealTimePrices, 2000); // Atualizar pre√ßos a cada 2s
           setInterval(updateSignalTimer, 1000); // Timer do pr√≥ximo sinal
           setInterval(updateSessionInfo, 5000); // Sess√£o a cada 5s
           
           // An√°lise autom√°tica a cada 5 minutos
           setInterval(() => {
               if (!isAnalyzing && !isMonitoring) {
                   performAnalysis();
               }
           }, 300000);
       });
   </script>
</body>
</html>
